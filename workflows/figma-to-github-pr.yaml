name: "Figma to GitHub Pull Request"
description: "GitHub MCPë¥¼ í™œìš©í•œ ìë™ PR ìƒì„± íŒŒì´í”„ë¼ì¸"

tasks:
  # 1. Figma ë””ìì¸ ë¶„ì„
  - id: "analyze-figma-changes"
    mcp: "figma-mcp"
    action: "detect-design-changes"
    params:
      figmaFileId: "${input.figmaFileId}"
      lastSync: "${context.lastSyncTime}"
    timeout: 30000

  # 2. Next.js ì»´í¬ë„ŒíŠ¸ ìƒì„±
  - id: "generate-components"
    mcp: "nextjs-mcp"
    action: "create-react-components"
    dependsOn: ["analyze-figma-changes"]
    params:
      designData: "${tasks.analyze-figma-changes.output}"
      outputDir: "./src/components/generated"
      generateTypes: true
    timeout: 45000

  # 3. GitHub ë¸Œëœì¹˜ ìƒì„±
  - id: "create-feature-branch"
    mcp: "github-mcp"
    action: "create-branch"
    dependsOn: ["generate-components"]
    params:
      repository: "${config.github.repository}"
      branchName: "feature/design-update-${timestamp}"
      baseBranch: "main"
    timeout: 15000

  # 4. ë³€ê²½ì‚¬í•­ ì»¤ë°‹
  - id: "commit-changes"
    mcp: "github-mcp"
    action: "commit-files"
    dependsOn: ["create-feature-branch"]
    params:
      repository: "${config.github.repository}"
      branch: "${tasks.create-feature-branch.output.branchName}"
      files: "${tasks.generate-components.output.files}"
      message: |
        ğŸ¨ Auto-generated components from Figma

        ## Changes Summary
        ${tasks.analyze-figma-changes.output.changesSummary}

        ## Generated Components
        ${tasks.generate-components.output.componentsList}

        ## Design Tokens Updated
        ${tasks.analyze-figma-changes.output.tokensChanged}

        ---
        - Figma File: ${input.figmaFileId}
        - Generated by: TaskManager MCP Pipeline
        - Timestamp: ${timestamp}

        [auto-commit]
    timeout: 30000

  # 5. Pull Request ìƒì„±
  - id: "create-pull-request"
    mcp: "github-mcp"
    action: "create-pull-request"
    dependsOn: ["commit-changes"]
    params:
      repository: "${config.github.repository}"
      title: "ğŸ¨ Design Update: ${tasks.analyze-figma-changes.output.changesSummary}"
      description: |
        ## ğŸ¨ ìë™ ìƒì„±ëœ ë””ìì¸ ì—…ë°ì´íŠ¸

        ì´ PRì€ Figma ë””ìì¸ ë³€ê²½ì‚¬í•­ì„ ìë™ìœ¼ë¡œ ê°ì§€í•˜ì—¬ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

        ### ğŸ“‹ ë³€ê²½ ì‚¬í•­
        ${tasks.analyze-figma-changes.output.detailedChanges}

        ### ğŸ§© ìƒì„±ëœ ì»´í¬ë„ŒíŠ¸
        ${tasks.generate-components.output.componentsList}

        ### ğŸ¨ ë””ìì¸ í† í°
        ${tasks.analyze-figma-changes.output.tokensChanged}

        ### ğŸ”— ì°¸ê³  ë§í¬
        - **Figma**: ${input.figmaFileUrl}
        - **ë¸Œëœì¹˜**: `${tasks.create-feature-branch.output.branchName}`
        - **ì»¤ë°‹**: ${tasks.commit-changes.output.commitUrl}

        ### âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸
        - [ ] ë””ìì¸ ê²€í†  ì™„ë£Œ
        - [ ] ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸ í™•ì¸
        - [ ] ì ‘ê·¼ì„± ê²€í† 
        - [ ] ë°˜ì‘í˜• í™•ì¸

        ---
        *ğŸ¤– ì´ PRì€ TaskManager MCPì— ì˜í•´ ìë™ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.*
      head: "${tasks.create-feature-branch.output.branchName}"
      base: "main"
      reviewers: ["${config.github.defaultReviewers}"]
      labels: ["design-system", "auto-generated", "figma-sync", "needs-review"]
    timeout: 20000

  # 6. íŒ€ ì•Œë¦¼ (Slack ë“±)
  - id: "notify-team"
    mcp: "notification-mcp"
    action: "send-notification"
    dependsOn: ["create-pull-request"]
    params:
      channels: ["#design-system", "#frontend-team"]
      message: |
        ğŸ¨ **ìƒˆë¡œìš´ ë””ìì¸ ì—…ë°ì´íŠ¸ PRì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!**

        **PR**: ${tasks.create-pull-request.output.prUrl}
        **ë³€ê²½ì‚¬í•­**: ${tasks.analyze-figma-changes.output.changesSummary}
        **ë¦¬ë·°ì–´**: ${config.github.defaultReviewers}

        ë¦¬ë·° ë¶€íƒë“œë¦½ë‹ˆë‹¤! ğŸ™
    timeout: 10000

# ì—ëŸ¬ ì²˜ë¦¬ ì „ëµ
errorHandling:
  strategy: "rollback"
  rollbackActions:
    - task: "create-feature-branch"
      action: "delete-branch"
    - task: "commit-changes"
      action: "reset-branch"

# ì•Œë¦¼ ì„¤ì •
notifications:
  onSuccess:
    - type: "console"
      message: "ğŸ‰ Figma to GitHub PR pipeline completed successfully!"
  onError:
    - type: "console"
      message: "âŒ Pipeline failed. Check logs for details."
  onProgress:
    - type: "console"
      message: "âš¡ Task ${task.id} in progress..."

# ì„¤ì •ê°’
config:
  github:
    repository: "your-org/your-repo"
    defaultReviewers: ["developer1", "designer1"]
